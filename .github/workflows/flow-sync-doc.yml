name: Flow sync-docs pipeline

on:
  # To create the button that runs a workflow manually:
  workflow_dispatch:

jobs:
  update-docs:
    runs-on: ubuntu-latest

    steps:

    # Write access is required later, so at least 1 way to allow it is under Settings/Actions/General
    # set "Workflow permissions" to "Read and write permissions" (may need similar org-wide change first).
    - name: Checkout Pages repo (the destination)
      uses: actions/checkout@v4
      with:
        path: 'dst_repo'

    - name: Checkout Source repo (the source)
      uses: actions/checkout@v4
      with:
        repository: 'Flow-IPC/flow'
        path: 'src_repo'

    - name: Mock Update Documentation
      run: |
        mkdir -p doc/versions/main
        echo "<h1>Hello, World!</h1>" >> doc/versions/main/index.html

    - name: Commit and push if there are changes
      run: |
        cd dst_repo
        # These values informally recommended in:
        #   https://github.com/actions/checkout#push-a-commit-using-the-built-in-token
        git config user.name github-actions
        git config user.email github-actions@github.com
        git add doc
        git commit -m 'Update documentation' || exit 0   # Exit gracefully if no changes
        git push origin main
